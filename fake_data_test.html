<!DOCTYPE html>
<html>
<head>
    <title>Fake Data Test - Real Mode</title>
    <script src="stitch/js/stitch-core.js"></script>
    <script src="stitch/js/stitch-state.js"></script>
    <script src="js/hardware-interface.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .demo { background: #cce5ff; color: #004085; }
        .real { background: #d1ecf1; color: #0c5460; }
        .fake { background: #fff3cd; color: #856404; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        .bar {
            width: 200px;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            transition: width 0.3s;
        }
        .focus-bar { background: #007bff; }
        .stress-bar { background: #dc3545; }
        .fatigue-bar { background: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§  Fake Data Test - Real Mode</h1>
        <p>This page demonstrates fake data generation when switching to real hardware mode without actual hardware.</p>
        
        <div class="card">
            <h2>System Status</h2>
            <div id="mode-status" class="status demo">DEMO MODE</div>
            <div id="hardware-status" class="status disconnected">No Hardware Connected</div>
            <div id="data-source" class="status disconnected">Data Source: Backend Simulation</div>
            
            <div style="margin: 20px 0;">
                <button onclick="connectFakeHardware()" class="btn-success">Connect Fake Hardware</button>
                <button onclick="disconnectHardware()" class="btn-danger">Disconnect Hardware</button>
                <button onclick="startRealData()" class="btn-primary">Simulate Real Data</button>
                <button onclick="stopRealData()" class="btn-warning">Stop Real Data</button>
            </div>
        </div>

        <div class="card">
            <h2>Brain States</h2>
            <div class="metric">
                <span>Focus:</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="bar"><div id="focus-bar" class="bar-fill focus-bar" style="width: 0%"></div></div>
                    <span id="focus-value">0%</span>
                </div>
            </div>
            <div class="metric">
                <span>Stress:</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="bar"><div id="stress-bar" class="bar-fill stress-bar" style="width: 0%"></div></div>
                    <span id="stress-value">0%</span>
                </div>
            </div>
            <div class="metric">
                <span>Fatigue:</span>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="bar"><div id="fatigue-bar" class="bar-fill fatigue-bar" style="width: 0%"></div></div>
                    <span id="fatigue-value">0%</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>EEG Bands</h2>
            <div class="metric">
                <span>Delta:</span>
                <span id="band-delta">0.00 ÂµVÂ²</span>
            </div>
            <div class="metric">
                <span>Theta:</span>
                <span id="band-theta">0.00 ÂµVÂ²</span>
            </div>
            <div class="metric">
                <span>Alpha:</span>
                <span id="band-alpha">0.00 ÂµVÂ²</span>
            </div>
            <div class="metric">
                <span>Beta:</span>
                <span id="band-beta">0.00 ÂµVÂ²</span>
            </div>
            <div class="metric">
                <span>Gamma:</span>
                <span id="band-gamma">0.00 ÂµVÂ²</span>
            </div>
        </div>

        <div class="card">
            <h2>How It Works</h2>
            <ol>
                <li><strong>Demo Mode:</strong> Uses backend simulation data</li>
                <li><strong>Connect Fake Hardware:</strong> Switches to real mode but shows fake data until real hardware connects</li>
                <li><strong>Simulate Real Data:</strong> Sends fake data as if it came from real hardware</li>
                <li><strong>Auto-switch:</strong> When real hardware data arrives, fake data stops automatically</li>
            </ol>
        </div>
    </div>

    <script>
        // Subscribe to state changes
        StitchState.subscribe((data, key, val) => {
            console.log(`State update: ${key} =`, val);
            
            // Update status indicators
            if (key === 'isRealHardware' || key === 'deviceStatus') {
                updateStatusDisplay(data);
            }
            
            // Update brain states
            if (key === 'brainStates') {
                updateBrainStates(val);
            }
            
            // Update EEG bands
            if (key === 'eegBands') {
                updateEEGBands(val);
            }
        });

        function updateStatusDisplay(state) {
            const modeStatus = document.getElementById('mode-status');
            const hardwareStatus = document.getElementById('hardware-status');
            const dataSource = document.getElementById('data-source');
            
            if (state.isRealHardware && state.deviceStatus === 'connected') {
                const hasRealData = window.HardwareInterface && window.HardwareInterface.hasRealData;
                
                if (hasRealData) {
                    modeStatus.textContent = 'REAL HARDWARE MODE';
                    modeStatus.className = 'status real';
                    dataSource.textContent = 'Data Source: Real Hardware';
                    dataSource.className = 'status connected';
                } else {
                    modeStatus.textContent = 'REAL HARDWARE MODE (FAKE DATA)';
                    modeStatus.className = 'status fake';
                    dataSource.textContent = 'Data Source: Fake Data (Waiting for Real Hardware)';
                    dataSource.className = 'status fake';
                }
                
                hardwareStatus.textContent = 'Hardware Connected: ' + (state.deviceInfo?.name || 'Unknown');
                hardwareStatus.className = 'status connected';
            } else {
                modeStatus.textContent = 'DEMO MODE';
                modeStatus.className = 'status demo';
                dataSource.textContent = 'Data Source: Backend Simulation';
                dataSource.className = 'status disconnected';
                hardwareStatus.textContent = 'No Hardware Connected';
                hardwareStatus.className = 'status disconnected';
            }
        }

        function updateBrainStates(states) {
            updateBar('focus', states.focus);
            updateBar('stress', states.stress);
            updateBar('fatigue', states.fatigue);
        }

        function updateEEGBands(bands) {
            document.getElementById('band-delta').textContent = bands.delta.toFixed(2) + ' ÂµVÂ²';
            document.getElementById('band-theta').textContent = bands.theta.toFixed(2) + ' ÂµVÂ²';
            document.getElementById('band-alpha').textContent = bands.alpha.toFixed(2) + ' ÂµVÂ²';
            document.getElementById('band-beta').textContent = bands.beta.toFixed(2) + ' ÂµVÂ²';
            document.getElementById('band-gamma').textContent = bands.gamma.toFixed(2) + ' ÂµVÂ²';
        }

        function updateBar(metric, value) {
            const bar = document.getElementById(`${metric}-bar`);
            const text = document.getElementById(`${metric}-value`);
            if (bar && text) {
                bar.style.width = `${Math.min(100, Math.max(0, value))}%`;
                text.textContent = `${value}%`;
            }
        }

        // Control functions
        window.connectFakeHardware = function() {
            // Simulate connecting to fake hardware
            if (window.HardwareInterface) {
                window.HardwareInterface.isRealHardware = true;
                window.HardwareInterface.isConnected = true;
                window.HardwareInterface.hasRealData = false;
                window.HardwareInterface.deviceInfo = {
                    type: 'websocket',
                    name: 'Fake EEG Device',
                    connected: true
                };
                
                StitchState.update({
                    deviceStatus: 'connected',
                    isRealHardware: true,
                    deviceInfo: window.HardwareInterface.deviceInfo
                });
                
                // Start fake data generation
                window.HardwareInterface.startFakeDataGeneration();
            }
        };

        window.disconnectHardware = function() {
            if (window.HardwareInterface) {
                window.HardwareInterface.disconnect();
            }
        };

        window.startRealData = function() {
            // Simulate receiving real data
            if (window.HardwareInterface) {
                const realData = {
                    timestamp: Date.now() / 1000,
                    channels: [Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50, Math.random() * 100 - 50],
                    bands: {
                        delta: Math.random() * 0.5,
                        theta: Math.random() * 0.8,
                        alpha: Math.random() * 1.2,
                        beta: Math.random() * 1.5,
                        gamma: Math.random() * 0.8
                    },
                    states: {
                        focus: Math.round(Math.random() * 100),
                        stress: Math.round(Math.random() * 100),
                        fatigue: Math.round(Math.random() * 100)
                    }
                };
                
                window.HardwareInterface.processEEGData(realData);
            }
        };

        window.stopRealData = function() {
            if (window.HardwareInterface) {
                window.HardwareInterface.hasRealData = false;
                window.HardwareInterface.startFakeDataGeneration();
            }
        };

        // Initialize display
        updateStatusDisplay(StitchState.get());
    </script>
</body>
</html>
